<div class="modal-header p-4">
  <h5 class="modal-title">Chi tiết đơn hàng #{{ orderDetail?.code }}</h5>
  <button type="button" class="btn-close" aria-label="Close" (click)="dismiss()"></button>
</div>

<div class="modal-body p-4" id="order-detail" *ngIf="orderDetail">
  <div class="row mb-4">
    <div class="col-md-6">
      <p class="mb-1"><strong>Ngày đặt:</strong> {{ orderDetail.orderDate | date:'dd/MM/yyyy HH:mm' }}</p>
      <p class="mb-1"><strong>Trạng thái:</strong>
        <span class="badge" [ngClass]="{
                'bg-success': orderDetail.status=='COMPLETED',
                'bg-warning': orderDetail.status=='PENDING',
                'bg-secondary': orderDetail.status!='COMPLETED' && orderDetail.status!='PENDING'
              }">{{ ORDER_STATUS[orderDetail.status] || orderDetail.status }}</span>
      </p>
      <p class="mb-1"><strong>Thanh toán:</strong> {{ PAYMENT_METHOD[orderDetail.paymentMethod] }}</p>
      <p class="mb-1"><strong>Trạng thái thanh toán:</strong> {{ PAYMENT_STATUS[orderDetail.paymentStatus] }}</p>
    </div>
  </div>

  <h6 class="border-bottom pb-2 mb-3 font-weight-bold">Danh sách sản phẩm</h6>
  <div class="table-responsive">
    <table class="table align-middle">
      <thead class="bg-light">
      <tr>
        <th style="width: 60px;">Ảnh</th>
        <th>Sản phẩm</th>
        <th style="width: 120px" class="text-end">Thành tiền</th>
        <th style="width: 80px" class="text-center" *ngIf="orderDetail.status === 'COMPLETED'">Tải file</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let prod of orderDetail.products">
        <td>
          <img [src]="prod.productThumbnail || 'assets/images/no-image.png'"
               alt="img"
               class="img-fluid rounded border"
               style="width: 50px; height: 50px; object-fit: cover;">
        </td>
        <td>
          <div class="fw-bold text-dark">{{ prod.productName }}</div>
          <div class="small text-muted">Mã SP: {{ prod.productCode }}</div>
          <div *ngIf="prod.note" class="small text-info fst-italic">Ghi chú: {{ prod.note }}</div>
        </td>
        <td class="align-middle text-end fw-bold">
          {{ prod.totalAmount | vndCurrency }}
        </td>
        <td *ngIf="orderDetail.status === 'COMPLETED'" class="align-middle text-center download-icon">
          <span [innerHTML]="ICON_DOWNLOAD | safeHtml" (click)="downloadFile(prod.id)"></span>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="row mt-3 justify-content-end">
    <div class="col-md-5">
      <div class="d-flex justify-content-between mb-2">
        <span>Tổng tiền hàng:</span>
        <span class="fw-bold">{{ orderDetail.amount | vndCurrency }}</span>
      </div>
      <div class="d-flex justify-content-between mb-2 text-success" *ngIf="orderDetail.discount > 0">
        <span>Giảm giá:</span>
        <span>- {{ orderDetail.discount | vndCurrency }}</span>
      </div>
      <hr>
      <div class="d-flex justify-content-between fs-5 fw-bold text-primary">
        <span>Tổng thanh toán:</span>
        <span>{{ orderDetail.totalAmount | vndCurrency }}</span>
      </div>
    </div>
  </div>
</div>

<div class="modal-footer p-4">
  <button class="cancel-button-dialog" (click)="dismiss()">Đóng</button>
  <button
    class="save-button-dialog"
    *ngIf="orderDetail?.paymentStatus === 'UNPAID' && orderDetail?.status === 'PENDING'"
    (click)="payOrder()"
  >
    Thanh toán
  </button>
  <button
    class="save-button-dialog"
    *ngIf="orderDetail?.status === 'COMPLETED' && notReviewed"
    (click)="openModalReview()"
  >
    Đánh giá
  </button>
</div>
